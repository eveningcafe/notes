{"componentChunkName":"component---node-modules-gatsby-theme-andy-src-templates-note-js","path":"/prometheus-prometheus-labels-relabel","result":{"data":{"brainNote":{"slug":"prometheus-prometheus-labels-relabel","title":"prometheus-prometheus-labels-relabel","childMdx":{"body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"prometheus-prometheus-labels-relabel\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"h1\", null, \"Prometheus labels\"), mdx(\"h2\", null, \"Labels\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Labels are a key part of Prometheus. and one of the things that make it powerful.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Labels are key-value pairs associated with time series that in addition to the metric name uniquely identify them.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Labels come from two sources, \", mdx(\"em\", {\n    parentName: \"li\"\n  }, \"instrumentation labels\"), \" and \", mdx(\"em\", {\n    parentName: \"li\"\n  }, \"target labels\"), \".\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Instrumentation labels as the name indicates come from your instrumentation. They are about things that are known inside your application or library, such as the type HTTP requests it receives, which databases it talks to and other internals.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Target labels identify a specific monitoring target, that is a target that Prometheus scrapes. They relate more to your architecture and may include which application it is, what datacenter it lives in, if it is in a development or production environment.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Target labels come from service discovery and relabeling.\")), mdx(\"h2\", null, \"Relabeling\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"NOTE: These two following pictures was gotten from \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.robustperception.io/life-of-a-label\"\n  }, \"Life of label\"), \". These one may be out-dated, based on Prometheus 0.17.0.\")), mdx(\"h3\", null, \"relabel_configs\"), mdx(\"p\", null, mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"https://www.robustperception.io/wp-content/uploads/2016/03/Life-of-a-Label-Target-Labels-495x640.png\",\n    \"alt\": \"relabel_configs\"\n  })), mdx(\"h3\", null, \"metric_relabel_configs\"), mdx(\"p\", null, mdx(\"img\", {\n    parentName: \"p\",\n    \"src\": \"https://www.robustperception.io/wp-content/uploads/2016/03/Life-of-a-Label-Scraping-445x640.png\",\n    \"alt\": \"metrics_relabel_configs\"\n  })), mdx(\"h3\", null, \"relabel_configs vs metric_relabel_configs\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"Prometheus needs to know what to scrape, and that's the where service discovery and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"relabel_configs\"), \" come in. Relabel configs allow you to select which targets you want to scraped, and what the target labels will be. So if you want to say scrape this type of machine but not that one, use \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"relabel_configs\"), \".\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"metrics_relabel_configs\"), \" by contrast are applied after the scrape has happened, but before the data is ingested by the storage system. So if there are some expensive metrics you want to drop, or labels coming from the scrape itself that you want to manipulate that's where \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"metrics_relabel_configs\"), \" applies.\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"p\", {\n    parentName: \"li\"\n  }, \"So as a simple rule of thumb: \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"relabel_configs\"), \" happens before the scrape, \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"metrics_relabel_configs\"), \" happens after the scrape. And if one doesn't work you can always try the other!\"))), mdx(\"h3\", null, \"Use cases\"), mdx(\"p\", null, \"Check \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://medium.com/quiq-blog/prometheus-relabeling-tricks-6ae62c56cbda\"\n  }, \"Prometheus relabeling tricks\")), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Drop unnecessary metrics\")), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"- job_name: cadvisor\\n  ...\\n  metric_relabel_configs:\\n  - source_labels: [__name__]\\n    regex: '(container_tasks_state|container_memory_failures_total)'\\n    action: drop\\n\")), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Drop unnecessary time-series\")), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"- job_name: cadvisor\\n  ...\\n  metric_relabel_configs:\\n  - source_labels: [id]\\n    regex: '/system.slice/var-lib-docker-containers.*-shm.mount'\\n    action: drop\\n  - source_labels: [container_label_JenkinsId]\\n    regex: '.+'\\n    action: drop\\n\")), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Drop sensitive or unwanted labels from metrics\")), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"- job_name: cadvisor\\n  ...\\n  metric_relabel_configs:\\n  - regex: 'container_label_com_amazonaws_ecs_task_arn'\\n    action: labeldrop\\n\")), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Amend label format of the final metrics\")), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"- job_name: cadvisor\\n  ...\\n  metric_relabel_configs:\\n  - source_labels: [image]\\n    regex: '.*/(.*)'\\n    replacement: '$1'\\n    target_label: id\\n  - source_labels: [service]\\n    regex: 'ecs-.*:ecs-([a-z]+-*[a-z]*).*:[0-9]+'\\n    replacement: '$1'\\n    target_label: service\\n\")), mdx(\"h3\", null, \"Real-world use case\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"strong\", {\n    parentName: \"li\"\n  }, \"Scenario\"), \": You have OpenStack cluster and you want to monitor its instance metrics dynamically. Ok, assume you got all instance (per project) metrics but endpoint (and instance) was something like \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"10.240.203.210:9100/...\"), \". You are unable to know which instance when look at this. So let's change this to instance name.\")), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"- job_name: 'openstack-node-exporter'\\n    openstack_sd_configs:\\n      - role: instance\\n        identity_endpoint: '...'\\n        username: '...'\\n        password: '...'\\n        domain_name: '...'\\n        port: 9100 # default node-exporter port\\n        refresh_interval: 20s\\n        region: '...'\\n        project_name: '...'\\n        all_tenants: true\\n\\n    relabel_configs:\\n      # keep only acgive instances\\n      - source_labels: [__meta_openstack_instance_status]\\n        action: keep\\n        regex: ACTIVE\\n\\n      # replace the default instance by the Openstack instance name\\n      - source_labels: [__meta_openstack_instance_name]\\n        target_label: instance\\n\\n      # amend label format of the final metrics\\n      - source_labels: [__meta_openstack_tag_service]\\n        target_label: service\\n        replacement: $1\\n\")));\n}\n;\nMDXContent.isMDXComponent = true;"},"inboundReferenceNotes":[{"title":"About these notes","slug":"about","childMdx":{"excerpt":"Hi, I'm  Kien Nguyen-Tuan  ðŸ‘‹. prometheus-promql-gotchas prometheus-prometheus-promql-join prometheus-prometheus-labels-relabel prometheusâ€¦"}}],"outboundReferenceNotes":[]},"site":{"siteMetadata":{"title":"@kiennt's notes"}}},"pageContext":{"slug":"prometheus-prometheus-labels-relabel"}},"staticQueryHashes":[]}